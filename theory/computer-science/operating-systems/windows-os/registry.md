# Registry

## Windows Registry

The Windows Registry is a hierarchical database that stores all kinds of settings and configuration information for your Windows operating system, as well as for installed applications and user preferences. Think of it as the control centre for your computer's settings.

The Windows Registry is stored in various Hive files, mainly in the `%SystemRoot%\System32\config` directory. The Registry also has hives that contain a specific type of information, like user settings, system settings, and hardware configurations.&#x20;

| Hive File             | Mapped Key Path                                                                                                                                                                                                                                                                                         | Purpose                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **SAM**               | `HKLM\Local_Machine\SAM`                                                                                                                                                                                                                                                                                | The Security Account Manager stores user account and security policy data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **SECURITY**          | `HKLM\SECURITY`                                                                                                                                                                                                                                                                                         | Holds security-related configuration data, including user authentication and permissions.                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **SYSTEM**            | `HKLM\SYSTEM`                                                                                                                                                                                                                                                                                           | Stores system-related configuration data, including hardware, device drivers, and startup settings.                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **SOFTWARE**          | `HKLM\SOFTWARE`                                                                                                                                                                                                                                                                                         | Contains configuration information for installed software and system-wide settings.                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **DEFAULT**           | `HKU\.DEFAULT`                                                                                                                                                                                                                                                                                          | Acts as a template for creating new user profiles, providing default settings for user-specific configuration.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **NTUSER.DAT**        | `HKCU`                                                                                                                                                                                                                                                                                                  | Contains user-specific settings for each user profile, including user preferences and specific configurations.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **USRCLASS.DAT**      | `HKCU\Software\Class`                                                                                                                                                                                                                                                                                   | Stores user-specific configuration.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| HKEY\_CURRENT\_CONFIG |                                                                                                                                                                                                                                                                                                         | <p><strong>Hardware profile-specific information</strong>. </p><h4>Examples:</h4><ul><li>Display resolution</li><li>Printer settings</li><li>Audio configs</li></ul><p></p><ul><li>Useful when dealing with <strong>multiple hardware profiles</strong> (e.g., docking station vs. undocked laptop).</li><li>Rarely directly edited — mostly used by the OS.</li></ul>                                                                                                                                                                    |
| HKEY\_USERS           |                                                                                                                                                                                                                                                                                                         | <p><strong>Registry profiles for all users</strong> on the system.</p><ul><li><code>HKEY_USERS\S-1-5-21-...</code> = settings for a specific user SID.</li><li>Includes <code>ntuser.dat</code> for each user (loaded at logon).</li></ul><p>Critical for forensic analysis (track user settings, persistence, or malware stashing configs).</p>                                                                                                                                                                                          |
| HKEY\_LOCAL\_MACHINE  | <p></p><ul><li><code>HKLM\SYSTEM</code> — services, drivers, control sets</li><li><code>HKLM\SOFTWARE</code> — installed software, Microsoft, policies</li><li><code>HKLM\SECURITY</code> — security database (protected)</li><li><code>HKLM\SAM</code> — local user account info (protected)</li></ul> | <p></p><ul><li><strong>System-wide settings</strong> — used by all users.</li><li>Persistent configuration, drivers, services.</li></ul><p></p><ul><li>Used heavily in hardening, malware analysis, and system troubleshooting.</li><li>Many <strong>privilege escalation paths</strong> abuse HKLM misconfigurations.</li></ul>                                                                                                                                                                                                          |
| HKEY\_CLASSES\_ROOT   |                                                                                                                                                                                                                                                                                                         | <p><strong>File association and COM object settings</strong>.<br></p><ul><li><code>.txt</code> → opens with Notepad</li><li>CLSID for registered COM components</li></ul><p>Attackers may hijack COM objects or file handlers for persistence (e.g., .txt file runs malware).</p>                                                                                                                                                                                                                                                         |
| HKEY\_CURRENT\_USEr   | HKEY\_USERS\<SID\_of\_logged\_in\_user>                                                                                                                                                                                                                                                                 | <p><code>HKEY_CURRENT_USER</code> is a <strong>shortcut (or alias)</strong> to the <strong>currently logged-in user’s</strong> registry hive.</p><p></p><p><strong>User-specific settings</strong>, like:</p><ul><li>Desktop background, themes, screen saver</li><li>Keyboard/mouse settings</li><li>Software/app configurations (e.g., for Microsoft Office, browsers)</li><li>Startup programs</li><li>PowerShell history</li><li>Mapped drives</li><li>Shell folders</li><li>Explorer view preferences</li><li>Recent files</li></ul> |





## Forensics

### **Dirty Hives and Transaction Logs**

Transaction logs are records of changes made to a database over time, while dirty Hives are parts of the Windows registry that haven't been properly closed after changes. Both are important in forensics for understanding system activity and potential security issues.

Sometimes, when your computer shuts down unexpectedly, or the Registry gets messed up, the Hive files can become "dirty," meaning they're inconsistent. To prevent corruption, Windows uses transaction logs. These logs track changes to the registry Hives, allowing Windows to roll back changes if something goes wrong.

The transaction logs are stored in the `C:\Windows\system32\config` directory alongside the Hive files. They have names like `SYSTEM.LOG1`, `SYSTEM.LOG2`, and so on.

Transaction logs are usually hidden files. One of the ways to view them is to open the terminal and run the command `dir /a` to display all the files present in the folder, including the hidden files, as shown below.



## Tools

* The Registry Editor loads the Live Hive to review, edit, delete the key/values, etc.
* Registry Explorer let's us analyse the registry Hives, both in Offline and Live mo
*
