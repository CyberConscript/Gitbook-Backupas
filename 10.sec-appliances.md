# 10.SEC appliances

In addition to the secure switching and routing appliances and protocols used to implement network connectivity, the network infrastructure design must also include security appliances to ensure confidentiality, integrity, and availability of services and data. You should be able to distinguish the features of security and monitoring devices and software and deploy these devices to appropriate locations in the network.

PACKET FILTERING FIREWALLS

Packet filtering describes the earliest type of network firewall. All firewalls can still perform this basic function.

## Access Control Lists (ACLs) <a href="#id-199ea50c-05d3-4d7c-9504-5026640b5eb5" id="id-199ea50c-05d3-4d7c-9504-5026640b5eb5"></a>

A packet filtering

A Layer 3 firewall technology that compares packet headers against ACLs to determine which network traffic to accept.

firewall is configured by specifying a group of rules, called an access control list (ACL). Each rule defines a specific type of data packet and the appropriate action to take when a packet matches the rule. An action can be either to deny (block or drop the packet, and optionally log an event) or to accept (let the packet pass through the firewall). Dropping is generally considered to be the more secure option versus 'Deny', as a denial response will let an attacker know which types of traffic are being actively blocked. A packet filtering firewall can inspect the headers of IP packets. This means that rules can be based on the information found in those headers:

* IP filtering—accepting or denying traffic on the basis of its source and/or destination IP address.
* Protocol ID/type (TCP, UDP, ICMP, routing protocols, and so on).
* Port filtering/security—accepting or denying a packet on the basis of source and destination port numbers (TCP or UDP application type).

There may be additional functionality in some products, such as the ability to block some types of ICMP (ping) traffic but not others, or the ability to filter by hardware (MAC) address. Another distinction that can be made is whether the firewall can control only inbound traffic or both inbound and outbound traffic. This is also often referred to as ingress and egress traffic or filtering. Controlling outbound traffic is useful because it can block applications that have not been authorized to run on the network and defeat malware, such as backdoors. Ingress and egress traffic is filtered using separate ACLs.

## Stateless Operation <a href="#id-8c331714-cb70-415a-b6b7-1364513763eb" id="id-8c331714-cb70-415a-b6b7-1364513763eb"></a>

A basic packet filtering firewall is stateless. This means that it does not preserve information about network sessions. Each packet is analyzed independently, with no record of previously processed packets. This type of filtering requires the least processing effort, but it can be vulnerable to attacks that are spread over a sequence of packets. A stateless firewall can also introduce problems in traffic flow, especially when some sort of load balancing is being used or when clients or servers need to use dynamically assigned ports.

## STATEFUL INSPECTION FIREWALLS

A stateful inspection firewall addresses these problems by tracking information about the session established between two hosts, or blocking malicious attempts to start a bogus session. The vast majority of firewalls now incorporate some level of stateful inspection capability. Session data is stored in a state table. When a packet arrives, the firewall checks it to confirm whether it belongs to an existing connection. If it does not, it applies the ordinary packet filtering rules to determine whether to allow it. Once the connection has been allowed, the firewall usually allows traffic to pass unmonitored, in order to conserve processing effort.

#### Transport Layer (OSI Layer 4) <a href="#id-89364134-48dc-4b7a-b12f-d5c65eb3a8fc" id="id-89364134-48dc-4b7a-b12f-d5c65eb3a8fc"></a>

At the transport layer, the firewall examines the TCP three-way handshake to distinguish new from established connections. A legitimate TCP connection should follow a SYN > SYN/ACK > ACK sequence to establish a session, which is then tracked using sequence numbers. Deviations from this, such as SYN without ACK or sequence number anomalies, can be dropped as malicious flooding or session hijacking attempts. The firewall can be configured to respond to such attacks by blocking source IP addresses and throttling sessions. It can also track UDP connections, though this is harder as UDP is a connectionless protocol. It is also likely to be able to detect IP header and ICMP anomalies.

#### Application Layer (OSI Layer 7) <a href="#id-021833a3-d356-4890-b1f5-7e570382fd98" id="id-021833a3-d356-4890-b1f5-7e570382fd98"></a>

An application-aware firewall can inspect the contents of packets at the application layer. One key feature is to verify the application protocol matches the port; to verify that malware isn't sending raw TCP data over port 80 just because port 80 is open, for instance. As another example, a web application firewall could analyze the HTTP headers and the HTML code present in HTTP packets to try to identify code that matches a pattern in its threat database. Application-aware firewalls have many different names, including application layer gateway, stateful multilayer inspection, or deep packet inspection. Application aware devices have to be configured with separate filters for each type of traffic (HTTP and HTTPS, SMTP/POP/IMAP, FTP, and so on). Application aware firewalls are very powerful, but they are not invulnerable. Their very complexity means that it is possible to craft DoS attacks against exploitable vulnerabilities in the firewall firmware. Also, the firewall cannot examine encrypted data packets, unless configured with an SSL/TLS inspector.

IPTABLES

iptables is a command line utility provided by many Linux distributions that allows administrators to edit the rules enforced by the Linux kernel firewall ([linux.die.net/man/8/iptables](https://linux.die.net/man/8/iptables)). iptables works with chains, which apply to the different types of traffic, such as the INPUT chain for traffic destined for the local host. Each chain has a default policy set to DROP or ACCEPT traffic that does not match a rule. Each rule, processed in order, determines whether traffic matching the criteria is allowed or dropped.

The command iptables --list INPUT --line-numbers -n will show the contents of the INPUT chain with line numbers and no name resolution. The rules in the following example drop any traffic from the specific host at 10.1.0.192 and allow ICMP echo requests (pings), DNS, and HTTP/HTTPS traffic either from the local subnet (10.1.0.0/24) or from any network (0.0.0.0/0):

Chain INPUT (policy DROP)

\# target prot opt source destination

1 DROP all -- 10.1.0.192 0.0.0.0/0

2 ACCEPT icmp -- 10.1.0.0/24 0.0.0.0/0 icmptype 8

3 ACCEPT udp -- 0.0.0.0/0 0.0.0.0/0 udp dpt:53

4 ACCEPT tcp -- 0.0.0.0/0 0.0.0.0/0 tcp dpt:53

5 ACCEPT tcp -- 10.1.0.0/24 0.0.0.0/0 tcp dpt:80

6 ACCEPT tcp -- 10.1.0.0/24 0.0.0.0/0 tcp dpt:443

7 ACCEPT all -- 0.0.0.0/0 0.0.0.0/0 ctstate RELATED,ESTABLISHED

The destination 0.0.0.0/0 means "anywhere." When set on the INPUT chain, the effect is to match any IP address that the local host is currently using. The ctstate rule is a stateful rule that allows any traffic that is part of an established or related session. As established connections should already have been allowed, this reduces processing requirements to minimize impact on traffic flow.

The following command will insert a new rule as line 2 to allow traffic to the SSH server TCP port (22) from the local subnet:

iptables -I INPUT 2 -p tcp -s 10.1.0.0/24 --dport 22 -j ACCEPT

Different switches can be used to append (-A), delete (-D), or replace (-R) rules.

## FIREWALL IMPLEMENTATION

You should consider how the firewall is implemented—as hardware or software, for instance—to cover a given placement or use on the network. Some types of firewalls are better suited for placement at the network edge or zonal borders; others are designed to protect individual hosts.

#### Firewall Appliances <a href="#f42787e3-796f-4b68-8488-b2003b1147e0" id="f42787e3-796f-4b68-8488-b2003b1147e0"></a>

An appliance firewall is a stand-alone hardware firewall deployed to monitor traffic passing into and out of a network zone. A firewall appliance can be deployed in two ways:

* Routed (layer 3)—the firewall performs forwarding between subnets. Each interface on the firewall connects to a different subnet and represents a different security zone.
* Bridged (layer 2)—the firewall inspects traffic passing between two nodes, such as a router and a switch. This is also referred to as transparent mode. The firewall does not have an IP interface (except for configuration management). It bridges the Ethernet interfaces between the two nodes. Despite performing forwarding at layer 2, the firewall can still inspect and filter traffic on the basis of the full range of packet headers. The typical use case for a transparent firewall is to deploy it without having to reconfigure subnets and reassign IP addresses on other devices.

A router firewall or firewall router appliance implements filtering functionality as part of the router firmware. The difference is that a router appliance is primarily designed for routing, with firewall as a secondary feature. SOHO Internet router/modems come with a firewall built-in, for example.

#### Application-Based Firewalls <a href="#id-7ced4e0c-0b1b-485e-8773-5cca1be67f9d" id="id-7ced4e0c-0b1b-485e-8773-5cca1be67f9d"></a>

Firewalls can also run as software on any type of computing host. There are several types of application-based firewalls:

* Host-based firewall (or personal firewall)—implemented as a software application running on a single host designed to protect that host only. As well as enforcing packet filtering ACLs, a personal firewall can be used to allow or deny software processes from accessing the network.
* Application firewall—software designed to run on a server to protect a particular application only (a web server firewall, for instance, or a firewall designed to protect an SQL Server database). This is a type of host-based firewall and would typically be deployed in addition to a network firewall.
* Network operating system (NOS) firewall—a software-based firewall running under a network server OS, such as Windows or Linux. The server would function as a gateway or proxy for a network segment.

## PROXIES AND GATEWAYS

A firewall that performs application layer filtering is likely to be implemented as a proxy. Where a network firewall only accepts or blocks traffic, a proxy server works on a store-and-forward model. The proxy deconstructs each packet, performs analysis, then rebuilds the packet and forwards it on, providing it conforms to the rules.

The amount of rebuilding depends on the proxy. Some proxies may only manipulate the IP and TCP headers. Application-aware proxies might add or remove HTTP headers. A deep packet inspection proxy might be able to remove content from an HTTP payload.

#### Forward Proxy Servers <a href="#id-6606e747-8a9f-4f28-bf83-1685f47b7258" id="id-6606e747-8a9f-4f28-bf83-1685f47b7258"></a>

A forward proxy provides for protocol-specific outbound traffic. For example, you might deploy a web proxy that enables client computers on the LAN to connect to websites and secure websites on the Internet. This is a forward proxy that services TCP ports 80 and 443 for outbound traffic.

The main benefit of a proxy is that client computers connect to a specified point on the perimeter network for web access. The proxy can be positioned within a DMZ. This provides for a degree of traffic management and security. In addition, most web proxy servers provide caching engines, whereby frequently requested web pages are retained on the proxy, negating the need to re-fetch those pages for subsequent requests.

A proxy server must understand the application it is servicing. For example, a web proxy must be able to parse and modify HTTP and HTTPS commands (and potentially HTML and scripts too). Some proxy servers are application-specific; others are multipurpose. A multipurpose proxy is one configured with filters for multiple protocol types, such as HTTP, FTP, and SMTP.

Proxy servers can generally be classed as non-transparent or transparent.

* A non-transparent proxy means that the client must be configured with the proxy server address and port number to use it. The port on which the proxy server accepts client connections is often configured as port 8080.
* A transparent (or forced or intercepting) proxy intercepts client traffic without the client having to be reconfigured. A transparent proxy must be implemented on a switch or router or other inline network appliance.

Both types of proxy can be configured to require users to be authenticated before allowing access. The proxy is likely to be able to use SSO to do this without having to prompt the user for a password.

A proxy autoconfiguration (PAC) script allows a client to configure proxy settings without user intervention. The Web Proxy Autodiscovery (WPAD) protocol allows browsers to locate a PAC file. This can be an attack vector, as a malicious proxy on the local network can be used to obtain the user's hash as the browser tries to authenticate ([nopsec.com/responder-beyond-wpad](https://www.nopsec.com/responder-beyond-wpad/)).

#### Reverse Proxy Servers <a href="#id-080243d5-2ed4-40ac-9074-a021d4a87568" id="id-080243d5-2ed4-40ac-9074-a021d4a87568"></a>

A reverse proxy server provides for protocol-specific inbound traffic. For security purposes, you might not want external hosts to be able to connect directly to application servers, such as web, email, and VoIP servers. Instead, you can deploy a reverse proxy on the network edge and configure it to listen for client requests from a public network (the Internet). The proxy applies filtering rules and if accepted, it creates the appropriate request for an application server within a DMZ. In addition, some reverse proxy servers can handle application-specific load balancing, traffic encryption, and caching, reducing the overhead on the application servers.

## ACCESS CONTROL LISTS

Firewall access control lists (ACLs) are configured on the principle of least access. This is the same as the principle of least privilege; only allow the minimum amount of traffic required for the operation of valid network services and no more. The rules in a firewall's ACL are processed top-to-bottom. If traffic matches one of the rules, then it is allowed to pass; consequently, the most specific rules are placed at the top. The final default rule is typically to block any traffic that has not matched a rule (implicit deny). If the firewall does not have a default implicit deny rule, an explicit deny all rule can be added manually to the end of the ACL.

Each rule can specify whether to block or allow traffic based on several parameters, often referred to as tuples. If you think of each rule being like a row in a database, the tuples are the columns. For example, in the previous screenshot, the tuples include Protocol, Source (address), (Source) Port, Destination (address), (Destination) Port, and so on.

Even the simplest packet filtering firewall can be complex to configure securely. It is essential to create a written policy describing what a filter ruleset should do and to test the configuration as far as possible to ensure that the ACLs you have set up work as intended. Also test and document changes made to ACLs. Some other basic principles include:

* Block incoming requests from internal or private IP addresses (that have obviously been spoofed).
* Block incoming requests from protocols that should only be functioning at a local network level, such as ICMP, DHCP, or routing protocol traffic.
* Use penetration testing to confirm the configuration is secure. Log access attempts and monitor the logs for suspicious activity.
* Take the usual steps to secure the hardware on which the firewall is running and use of the management interface.

## NETWORK ADDRESS TRANSLATION

Network address translation (NAT) was devised as a way of freeing up scarce IP addresses for hosts needing Internet access. A private network will typically use a private addressing scheme to allocate IP addresses to hosts. These addresses can be drawn from one of the pools of addresses defined in RFC 1918 ([tools.ietf.org/html/rfc1918](https://tools.ietf.org/html/rfc1918)) as non-routable over the Internet:

* 10.0.0.0 to 10.255.255.255 (Class A private address range).
* 172.16.0.0 to 172.31.255.255 (Class B private address range).
* 192.168.0.0 to 192.168.255.255 (Class C private address range).

A NAT gateway is a service that translates between the private addressing scheme used by hosts on the LAN and the public addressing scheme used by router, firewall, or proxy server on the network edge. NAT provides security in the sense that it can manage ingress and egress traffic at well-defined points on the network edge, but it is important to realize that it does not perform a filtering function.

<figure><img src="https://s3.amazonaws.com/wmx-api-production/courses/5731/images/nat-overloading.png" alt="nat-overloading.png"><figcaption></figcaption></figure>

* Destination NAT/port forwarding—uses the router's public address to publish a web service, but forwards incoming requests to a different IP. Port forwarding means that the router takes requests from the Internet for a particular application (say, HTTP/port 80) and sends them to a designated host and port in the DMZ or LAN.

<figure><img src="https://s3.amazonaws.com/wmx-api-production/courses/5731/images/8572-1599771804610.png" alt="Edit Redirect Entry has Interface (WAN), Protocol (TCP), Destination port range (Any), Redirect target IP (10.1.0.10), and Redirect target port (HTTP)"><figcaption></figcaption></figure>

The larger IPv6 address space makes most use cases for NAT redundant. A host can use a link-local address to contact neighboring nodes, but any routed traffic should use a globally unique address. In IPv6 it is routing policies and firewall filtering that manage which hosts and networks are reachable. That said, there are mechanisms for translating prefixes at the network edge (NPTv6) and for translation between IPv6 addresses (NAT66) or IPv6 and IPv4 addresses (NAT64 and NAT46).

## VIRTUAL FIREWALLS

Virtual firewalls are usually deployed within data centers and cloud services. A virtual firewall can be implemented in three different ways:

* Hypervisor-based—this means that filtering functionality is built into the hypervisor or cloud provisioning tool. You can use the cloud's web app or application programming interface (API) to write access control lists (ACLs) for traffic arriving or leaving a virtual host or virtual network.
* Virtual appliance—this refers to deploying a vendor firewall appliance instance using virtualization, in the same way you might deploy a Windows or Linux guest OS.
* Multiple context—this refers to multiple virtual firewall instances running on a hardware firewall appliance. Each context has a separate interface and can perform a distinct filtering role.

While they can be deployed like "regular" firewalls for zone-based routing and filtering, virtual firewalls' most significant role is to support the east-west security and zero-trust microsegmentation design paradigms. They are able to inspect traffic as it passes from host-to-host or between virtual networks, rather than requiring that traffic be routed up to a firewall appliance and back.

OPEN-SOURCE VERSUS PROPRIETARY FIREWALLS

The ability to inspect source code will be a requirement for high-security environments that cannot rely on implicit trust when selecting vendors. The code underpinning appliance-based, software, and virtual firewalls can be developed as open-source or proprietary or somewhere in between:

* Wholly proprietary—implemented as a proprietary OS, such as Cisco ASA, Juniper JunOS, PaloAlto PAN-OS, or Barracuda's Windows-based appliance.
* Mostly proprietary—developed from a Linux kernel, but with proprietary features added. Examples include Check Point IPSO, FortiGate FortiOS, and Sonicwall. Any code developed from a GPL source should be available, but in general terms these products cannot be used independently of a commercial contract with the vendor.
* Wholly open-source—these can be used independently of the vendor, but the vendors typically have commercial appliances and support contracts too. Examples include pfSense and Smoothwall.

In determining whether to follow a self-installed versus supported deployment, as well as the core appliance code, you need to consider access to support, update availability, and access to subscription-based features, such as signatures and threat feeds.

## NETWORK-BASED INTRUSION DETECTION SYSTEMS

An intrusion detection system (IDS) is a means of using software tools to provide real-time analysis of either network traffic or system and application logs. A network-based IDS (NIDS) captures traffic via a packet sniffer, referred to as a sensor. It analyzes the packets to identify malicious traffic and displays alerts to a console or dashboard.

A NIDS, such as Snort ([snort.org](https://www.snort.org/)), Suricata ([suricata-ids.org](https://suricata-ids.org/)), or Zeek/Bro ([zeek.org](https://zeek.org/)) performs passive detection. When traffic is matched to a detection signature, it raises an alert or generates a log entry, but does not block the source host. This type of passive sensor does not slow down traffic and is undetectable by the attacker. It does not have an IP address on the monitored network segment.

A NIDS is used to identify and log hosts and applications and to detect attack signatures, password guessing attempts, port scans, worms, backdoor applications, malformed packets or sessions, and policy violations (ports or IP addresses that are not permitted, for instance). You can use analysis of the logs to tune firewall rulesets, remove or block suspect hosts and processes from the network, or deploy additional security controls to mitigate any threats you identify.

## TAPS AND PORT MIRRORS

Typically, the packet capture sensor is placed inside a firewall or close to a server of particular importance. The idea is usually to identify malicious traffic that has managed to get past the firewall. A single IDS can generate a very large amount of logging and alerting data so you cannot just put multiple sensors everywhere in the network without provisioning the resources to manage them properly. Depending on network size and resources, one or just a few sensors will be deployed to monitor key assets or network paths.

There are three main options for connecting a sensor to the appropriate point in the network:

* SPAN (switched port analyzer)/mirror port—this means that the sensor is attached to a specially configured port on the switch that receives copies of frames addressed to nominated access ports (or all the other ports). This method is not completely reliable. Frames with errors will not be mirrored and frames may be dropped under heavy load.
* Passive test access point (TAP)—this is a box with ports for incoming and outgoing network cabling and an inductor or optical splitter that physically copies the signal from the cabling to a monitor port. There are types for copper and fiber optic cabling. Unlike a SPAN, no logic decisions are made so the monitor port receives every frame—corrupt or malformed or not—and the copying is unaffected by load.
* Active TAP—this is a powered device that performs signal regeneration (again, there are copper and fiber variants), which may be necessary in some circumstances. Gigabit signaling over copper wire is too complex for a passive tap to monitor and some types of fiber links may be adversely affected by optical splitting. Because it performs an active function, the TAP becomes a point of failure for the links in the event of power loss. When deploying an active TAP, it is important to use a model with internal batteries or connect it to a UPS.

A TAP will usually output two streams to monitor a full-duplex link (one channel for upstream and one for downstream). Alternatively, there are aggregation TAPs, which rebuild the streams into a single channel, but these can drop frames under very heavy load.

## NETWORK-BASED INTRUSION PREVENTION SYSTEMS

Compared to the passive function of an IDS, an intrusion prevention system (IPS) can provide an active response to any network threats that it matches. One typical preventive measure is to end the TCP session, sending a TCP reset packet to the attacking host. Another option is for the IPS to apply a temporary filter on the firewall to block the attacker's IP address (shunning). Other advanced measures include throttling bandwidth to attacking hosts, applying complex firewall filters, and even modifying suspect packets to render them harmless. Finally, the appliance may be able to run a script or third-party program to perform some other action not supported by the IPS software itself.

Some IPS provide inline, wire-speed antivirus scanning. Their rulesets can be configured to provide user content filtering, such as blocking URLs, applying keyword-sensitive block lists or allow lists, or applying time-based access restrictions.

IPS appliances are positioned like firewalls at the border between two network zones. As with proxy servers, the appliances are "inline" with the network, meaning that all traffic passes through them (also making them a single point-of-failure if there is no fault tolerance mechanism). This means that they need to be able to cope with high bandwidths and process each packet very quickly to avoid slowing down the network.

## SIGNATURE-BASED DETECTION

In an IDS, the analysis engine is the component that scans and interprets the traffic captured by the sensor with the purpose of identifying suspicious traffic. The analysis engine determines how any given event should be classed, with typical options to ignore, log only, alert, and block (IPS). The analysis engine is programmed with a set of rules that it uses to drive its decision-making process. There are several methods of formulating the ruleset.

Signature-based detection (or pattern-matching) means that the engine is loaded with a database of attack patterns or signatures. If traffic matches a pattern, then the engine generates an incident.

The signatures and rules (often called plug-ins or feeds) powering intrusion detection need to be updated regularly to provide protection against the latest threat types. Commercial software requires a paid-for subscription to obtain the updates. It is important to ensure that the software is configured to update only from valid repositories, ideally using a secure connection method, such as HTTPS.

## BEHAVIOR AND ANOMALY-BASED DETECTION

Behavioral-based detection means that the engine is trained to recognize baseline "normal" traffic or events. Anything that deviates from this baseline (outside a defined level of tolerance) generates an incident. The idea is that the software will be able to identify zero day attacks, insider threats, and other malicious activity for which there is no signature.

Historically, this type of detection was provided by network behavior and anomaly detection (NBAD) products. An NBAD engine uses heuristics to generate a statistical model of what baseline normal traffic looks like. It may develop several profiles to model network use at different times of the day. This means that the system generates false positive and false negatives until it has had time to improve its statistical model of what is "normal." A false positive is where legitimate behavior generates an alert, while a false negative is where malicious activity is not alerted.

While NBAD products were relatively unsophisticated, the use of machine learning in more recent products has helped to make them more productive. As identified by Gartner's market analysis ([gartner.com/en/documents/3917096/market-guide-for-user-and-entity-behavior-analytics](https://www.gartner.com/en/documents/3917096/market-guide-for-user-and-entity-behavior-analytics)), there are two general classes of behavior-based detection products that utilize machine learning:

* User and entity behavior analytics (UEBA)—these products scan indicators from multiple intrusion detection and log sources to identify anomalies. They are often integrated with security information and event management (SIEM) platforms.
* Network traffic analysis (NTA)—these products are closer to IDS and NBAD in that they apply analysis techniques only to network streams, rather than multiple network and log data sources.

Often behavioral- and anomaly-based detection are taken to mean the same thing (in the sense that the engine detects anomalous behavior). Anomaly-based detection can also be taken to mean specifically looking for irregularities in the use of protocols. For example, the engine may check packet headers or the exchange of packets in a session against RFC standards and generate an alert if they deviate from strict RFC compliance.

NEXT-GENERATION FIREWALLS AND CONTENT FILTERS

While intrusion detection was originally produced as standalone software or appliances, its functionality very quickly became incorporated into a new generation of firewalls. The original next-generation firewall (NGFW) was released as far back as 2010 by Palo Alto. This product combined application-aware filtering with user account-based filtering and the ability to act as an intrusion prevention system (IPS). This approach was quickly adopted by competitor products. Subsequent firewall generations have added capabilities such as cloud inspection and combined features of different security technologies.

#### Unified Threat Management (UTM) <a href="#id-4ba7d47d-ab74-4145-9c54-995d04360f92" id="id-4ba7d47d-ab74-4145-9c54-995d04360f92"></a>

#### Content/URL Filter <a href="#a96d9ab3-5238-4cd2-8576-776fea07a8f2" id="a96d9ab3-5238-4cd2-8576-776fea07a8f2"></a>

A firewall has to sustain high loads, and overloads can increase latency or even cause outages. The high complexity of application-aware NGFW and UTM solutions can reduce their suitability as an edge device, because while they might provide high confidentiality and integrity, lower throughput reduces availability. One solution to this is to treat security solutions for server traffic differently from that for user traffic. User traffic refers to web browsing, social networking, email, and video/VoIP connections initiated by local network clients.

Consequently, where a stateful or NGFW may be deployed for application server traffic, the job of filtering user traffic is often performed by a separate appliance or proxy host. A content filter is designed to apply a number of user-focused filtering rules, such as blocking uniform resource locators (URLs) that appear on content block lists or applying time-based restrictions to browsing. Content filters are now usually implemented as a class of product called a secure web gateway (SWG). As well as filtering, a SWG performs threat analysis and often integrates the functionality of data loss prevention (DLP) and cloud access security brokers (CASB) to protect against the full range of unauthorized egress threats, including malware command and control and data exfiltration.

An appliance or proxy server that mediates client connections with the Internet by filtering spam and malware and enforcing access restrictions on types of sites visited, time spent, and bandwidth consumed.

HOST-BASED INTRUSION DETECTION SYSTEMS

A host-based IDS (HIDS) captures information from a single host, such as a server, router, or firewall. Some organizations may configure HIDS on each client workstation. HIDS come in many different forms with different capabilities. The core ability is to capture and analyze log files, but more sophisticated systems can also monitor OS kernel files, monitor ports and network interfaces, and process data and logs generated by specific applications, such as HTTP or FTP.

## WEB APPLICATION FIREWALLS

A web application firewall (WAF) is designed specifically to protect software running on web servers and their back-end databases from code injection and DoS attacks. WAFs use application-aware processing rules to filter traffic and perform application-specific intrusion detection. The WAF can be programmed with signatures of known attacks and use pattern matching to block requests containing suspect code. The output from a WAF will be written to a log, which you can inspect to determine what threats the web application might be subject to.

A WAF may be deployed as an appliance or as plug-in software for a web server platform. Some examples of WAF products include:

* ModSecurity ([modsecurity.org](https://www.modsecurity.org/)) is an open source (sponsored by Trustwave) WAF for Apache, nginx, and IIS.
* NAXSI ([github.com/nbs-system/naxsi](https://github.com/nbs-system/naxsi)) is an open source module for the nginx web server software.
* Imperva ([imperva.com](https://www.imperva.com/)) is a commercial web security offering with a particular focus on data centers. Imperva markets WAF, DDoS, and database security through its SecureSphere appliance.

## MONITORING SERVICES

Security assessments and incident response both require real-time monitoring of host and network status indicators plus audit information.

#### Packet Capture <a href="#id-31c46a9e-4346-4416-96af-6720b589dfcf" id="id-31c46a9e-4346-4416-96af-6720b589dfcf"></a>

#### Network Monitors <a href="#id-3a5a8820-f3f9-492f-a0d6-201248b20a3d" id="id-3a5a8820-f3f9-492f-a0d6-201248b20a3d"></a>

As distinct from network traffic monitoring, a network monitor collects data about network appliances, such as switches, access points, routers, firewalls, and servers. This is used to monitor load status for CPU/memory, state tables, disk capacity, fan speeds/temperature, network link utilization/error statistics, and so on. Another important function is a heartbeat message to indicate availability. This data might be collected using the Simple Network Management Protocol (SNMP) or a proprietary management system. As well as supporting availability, network monitoring might reveal unusual conditions that could point to some kind of attack.

#### Logs <a href="#id-161397b4-84b5-4815-a78a-e03634313a99" id="id-161397b4-84b5-4815-a78a-e03634313a99"></a>

Logs are one of the most valuable sources of security information. A system log can be used to diagnose availability issues. A security log can record both authorized and unauthorized uses of a resource or privilege. Logs function both as an audit trail of actions and (if monitored regularly) provide a warning of intrusion attempts. Log review is a critical part of security assurance. Only referring to the logs following a major incident is missing the opportunity to identify threats and vulnerabilities early and to respond proactively. Logs typically associate an action with a particular user. This is one of the reasons that it is critical that users not share logon details. If a user account is compromised, there is no means of tying events in the log to the actual attacker.

## SECURITY INFORMATION AND EVENT MANAGEMENT

Software designed to assist with managing security data inputs and provide reporting and alerting is often described as security information and event management (SIEM). The core function of a SIEM tool is to aggregate traffic data and logs. In addition to logs from Windows and Linux-based hosts, this could include switches, routers, firewalls, IDS sensors, vulnerability scanners, malware scanners, data loss prevention (DLP) systems, and databases.

#### Log Collection <a href="#id-20914461-7edd-4c6e-9d22-bb2a75447038" id="id-20914461-7edd-4c6e-9d22-bb2a75447038"></a>

The first task for SIEM is to collect data inputs from multiple sources. There are three main types of log collection:

* Agent-based—with this approach, you must install an agent service on each host. As events occur on the host, logging data is filtered, aggregated, and normalized at the host, then sent to the SIEM server for analysis and storage.
*   Listener/collector×

    A network appliance that gathers or receives log and/or state data from other network systems.

    —rather than installing an agent, hosts can be configured to push updates to the SIEM server using a protocol such as syslog or SNMP. A process runs on the management server to parse and normalize each log/monitoring source.\
    \
    Syslog ([tools.ietf.org/html/rfc3164](https://tools.ietf.org/html/rfc3164)) allows for centralized collection of events from multiple sources. It also provides an open format for event logging messages, and as such has become a de facto standard for logging of events from distributed systems. For example, syslog messages can be generated by Cisco routers and switches, as well as servers and workstations.
* Sensor—as well as log data, the SIEM might collect packet captures and traffic flow data from sniffers.

#### Log Aggregation <a href="#id-006f0bde-a00b-4394-8a79-0c2cbb679693" id="id-006f0bde-a00b-4394-8a79-0c2cbb679693"></a>

Log aggregation refers to normalizing data from different sources so that it is consistent and searchable. SIEM software features connectors or plug-ins to interpret (or parse) data from distinct types of systems and to account for differences between vendor implementations. Usually parsing will be carried out using regular expressions tailored to each log file format to identify attributes and content that can be mapped to standard fields in the SIEM's reporting and analysis tools. Another important function is to normalize date/time zone differences to a single timeline.

ANALYSIS AND REPORT REVIEW

Where collection and aggregation produce inputs, a SIEM is also used for reporting. A critical function of SIEM—and the principal factor distinguishing it from basic log management—is that of correlation. This means that the SIEM software can link individual events or data points (observables) into a meaningful indicator of risk, or Indicator of Compromise (IOC). Correlation can then be used to drive an alerting system. These reports would be viewed from the SIEM dashboard.

Basic correlation can be performed using simple If…Then type rules. However, many SIEM solutions use artificial intelligence (AI) and machine learning as the basis for automated analysis.

#### User and Entity Behavior Analytics <a href="#a4545c6a-636e-4e6a-ad25-ebced6c04cf7" id="a4545c6a-636e-4e6a-ad25-ebced6c04cf7"></a>

#### Sentiment Analysis <a href="#b111781e-01be-43e1-86d8-0271b621d731" id="b111781e-01be-43e1-86d8-0271b621d731"></a>

One of the biggest challenges for behavior analytics driven by machine learning is to identify intent. It is extremely difficult for a machine to establish the context and interpretation of statements in natural language, though much progress is being made. The general efforts in this area are referred to as sentiment analysis, or emotion AI. The typical use case for sentiment analysis is to monitor social media for brand "incidents," such as a disgruntled customer announcing on Twitter what poor customer service they have just received. In terms of security, this can be used to gather threat intelligence and try to identify external or insider threats before they can develop as attacks.

#### Security Orchestration, Automation, and Response <a href="#id-4e016567-bd97-4297-817a-f57ec608f745" id="id-4e016567-bd97-4297-817a-f57ec608f745"></a>

Security orchestration, automation, and response (SOAR) is designed as a solution to the problem of the volume of alerts overwhelming analysts' ability to respond. A SOAR may be implemented as a standalone technology or integrated with a SIEM—often referred to as a next-gen SIEM. The basis of SOAR is to scan the organization's store of security and threat intelligence, analyze it using machine/deep learning techniques, and then use that data to automate and provide data enrichment for the workflows that drive incident response and threat hunting.

ANALYSIS AND REPORT REVIEW

Where collection and aggregation produce inputs, a SIEM is also used for reporting. A critical function of SIEM—and the principal factor distinguishing it from basic log management—is that of correlation. This means that the SIEM software can link individual events or data points (observables) into a meaningful indicator of risk, or Indicator of Compromise (IOC). Correlation can then be used to drive an alerting system. These reports would be viewed from the SIEM dashboard.

Basic correlation can be performed using simple If…Then type rules. However, many SIEM solutions use artificial intelligence (AI) and machine learning as the basis for automated analysis.

#### User and Entity Behavior Analytics <a href="#a4545c6a-636e-4e6a-ad25-ebced6c04cf7" id="a4545c6a-636e-4e6a-ad25-ebced6c04cf7"></a>

#### Sentiment Analysis <a href="#b111781e-01be-43e1-86d8-0271b621d731" id="b111781e-01be-43e1-86d8-0271b621d731"></a>

One of the biggest challenges for behavior analytics driven by machine learning is to identify intent. It is extremely difficult for a machine to establish the context and interpretation of statements in natural language, though much progress is being made. The general efforts in this area are referred to as sentiment analysis, or emotion AI. The typical use case for sentiment analysis is to monitor social media for brand "incidents," such as a disgruntled customer announcing on Twitter what poor customer service they have just received. In terms of security, this can be used to gather threat intelligence and try to identify external or insider threats before they can develop as attacks.

#### Security Orchestration, Automation, and Response <a href="#id-4e016567-bd97-4297-817a-f57ec608f745" id="id-4e016567-bd97-4297-817a-f57ec608f745"></a>

Security orchestration, automation, and response (SOAR) is designed as a solution to the problem of the volume of alerts overwhelming analysts' ability to respond. A SOAR may be implemented as a standalone technology or integrated with a SIEM—often referred to as a next-gen SIEM. The basis of SOAR is to scan the organization's store of security and threat intelligence, analyze it using machine/deep learning techniques, and then use that data to automate and provide data enrichment for the workflows that drive incident response and threat hunting.

FILE MANIPULATION

While SIEM can automate many functions of log collection and review, you may also have to manually prepare data using a Linux command line.

#### The cat Command <a href="#id-7ab599d4-3e2d-45bd-bbfa-dac51e385195" id="id-7ab599d4-3e2d-45bd-bbfa-dac51e385195"></a>

#### The head and tail Commands <a href="#id-529de68c-48f8-451d-98fb-253cacc45f6a" id="id-529de68c-48f8-451d-98fb-253cacc45f6a"></a>

The head and tail commands output the first and last 10 lines respectively of a file you provide. You can also adjust this default value to output more or fewer lines using the -n switch. For example, the following command shows the 20 most recent entries in a log file:

tail /var/log/messages -n 20

#### The logger Command <a href="#d72c678e-f2e0-459a-b070-36a24f5bb6ea" id="d72c678e-f2e0-459a-b070-36a24f5bb6ea"></a>

The logger command writes input to the local system log or to a remote syslog server ([linux.die.net/man/1/logger](https://linux.die.net/man/1/logger)). You can use the command in a script to write any text string or use the -f option to write the contents of another file. You can also write the output of commands by enclosing the command in backticks. The following command writes the name of the local machine along with the text "up" to the syslog server at 10.1.0.242:

logger -n 10.1.0.242 \`hostname\` up

REGULAR EXPRESSIONS AND GREP

Filtering a log to discover data points of interest usually involves some sort of string search, typically invoking regular expression (regex) syntax. A regular expression is a search pattern to match within a given string. The search pattern is built from the regex syntax. This syntax defines metacharacters that function as search operators, quantifiers, logic statements, and anchors/boundaries. The following list illustrates some commonly used elements of regex syntax:

* \[ … ] matches a single instance of a character within the brackets. This can include literals, ranges such as \[a-z], and token matches, such as \[\s] (white space) or \[\d] (one digit).
* \+ matches one or more occurrences. A quantifier is placed after the term to match; for example, \s+ matches one or more white space characters.
* \* matches zero or more times.
* ? matches once or not at all.
* {} matches a number of times. For example, {2} matches two times, {2,} matches two or more times, and {2,5} matches two to five times.

The grep command invokes simple string matching or regex syntax to search text files for specific strings. This enables you to search the entire contents of a text file for a specific pattern within each line and display that pattern on the screen or dump it to another file. A simple example of grep usage is as follows:

grep -F 192.168.1.254 access.log

This searches the text file access.log for all lines containing some variation of the literal string pattern 192.168.1.254 and prints only those lines to the terminal. The -F switch instructs grep to treat the pattern as a literal.

The following example searches for any IP address in the 192.168.1.0/24 subnet using regex syntax for the pattern (note that each period must be escaped) within any file in any directory from the current one. The -r option enables recursion, while the period in the target part indicates the current directory:

grep -r 192\\.168\\.1\\.\[\d]{1,3} ./\*
